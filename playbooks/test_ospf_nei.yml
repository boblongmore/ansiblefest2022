---
- name: test ospf in CML
  hosts: routers
  gather_facts: false

  tasks:

    - name: parse show ip ospf neighbors
      ansible.utils.cli_parse:
        command: show ip ospf neighbor
        parser:
          name: ansible.netcommon.pyats
        set_fact: ospf_neighbors
      ignore_errors: true

    - name: determine if there are ospf neighbors
      block:
        # - name: check if error is returned for ospf neighbors
        #   debug:
        #     msg: "{{ ospf_neighbors['interfaces'] }}"
        - name: collect relevant interface data to create a report
          set_fact:
            ospf_neighbors: "{{ ospf_neighbors['interfaces'] | dict2items }}"
      rescue:
        - name: print which device has errors on show ip ospf neighbors
          debug:
            msg: "{{ inventory_hostname }} did not return ospf neighbors"

    - name: pass variable to workflow
      set_stats:
        data:
          ospf_neighbors: "{{ ospf_neighbors }}"



